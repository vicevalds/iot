# Configuración temporal de Apache2 para obtener certificados Let's Encrypt
# Esta configuración solo permite HTTP y el challenge de Let's Encrypt

ServerName iot.vicevalds.dev

# Módulos mínimos necesarios
LoadModule mpm_event_module modules/mod_mpm_event.so
LoadModule authz_core_module modules/mod_authz_core.so
LoadModule log_config_module modules/mod_log_config.so
LoadModule unixd_module modules/mod_unixd.so
LoadModule dir_module modules/mod_dir.so
LoadModule mime_module modules/mod_mime.so

# Configuración básica
ServerRoot "/usr/local/apache2"
Listen 80

User www-data
Group www-data

# Logging
ErrorLog /proc/self/fd/2
LogLevel warn
LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
CustomLog /proc/self/fd/1 combined

# Tipos MIME
TypesConfig conf/mime.types

# Servidor HTTP para obtener certificados
<VirtualHost *:80>
    ServerName iot.vicevalds.dev

    # Directorio para Let's Encrypt challenge
    DocumentRoot /var/www/certbot

    <Directory /var/www/certbot>
        Options -Indexes +FollowSymLinks
        AllowOverride None
        Require all granted
    </Directory>

    # Permitir acceso al challenge de Let's Encrypt
    <Location /.well-known/acme-challenge/>
        Options -Indexes
        Require all granted
    </Location>

    # Para otras rutas, retornar un mensaje de inicialización
    <LocationMatch "^/(?!\.well-known/acme-challenge/)">
        ErrorDocument 503 "SSL initialization in progress. Please wait..."
    </LocationMatch>
</VirtualHost>
